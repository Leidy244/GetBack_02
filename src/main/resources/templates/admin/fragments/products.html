<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<body>
	<section class="content-section" th:fragment="products">
		<section>
			<!-- Botón Nuevo Producto -->
			<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
				data-bs-target="#nuevoProductoModal">
				Nuevo Producto
			</button>

			<!-- Tabla de Productos -->
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Nombre</th>
						<th>Descripción</th>
						<th>Precio</th>
						<th>Categoria</th>
						<th>Disponible</th>
						<th>Imagen</th>
						<th>Acciones</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="producto : ${products}">
						<td th:text="${producto.nombreProducto}">Nombre</td>
						<td th:text="${producto.descripcion}">Descripción</td>
						<td th:text="${producto.precio}">Precio</td>
						<td th:text="${producto.categoria.nombre}">Categoria</td>
						<td>
							<span th:text="${producto.disponible} ? 'Sí' : 'No'">Disponible</span>
						</td>
						<TD>
							<div class="mb-3">
								<label class="form-label">Imagen Actual</label>
								<div>
									<img th:src="@{${producto.imagen}}" alt="Imagen del producto" class="img-fluid"
										style="max-height: 150px;">
								</div>
							</div>
						</TD>
						<td>
							<button class="btn btn-warning btn-sm" data-bs-toggle="modal"
								th:data-bs-target="'#productoModalEdit' + ${producto.id}">
								Editar
							</button>
							<a th:href="@{'/admin/menu/productos/eliminar/' + ${producto.id}}"
								class="btn btn-danger btn-sm">Eliminar</a>
						</td>
					</tr>
				</tbody>
			</table>

			<!-- Modal Nuevo Producto -->
			<div class="modal fade" id="nuevoProductoModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<form th:action="@{/admin/menu/productos/guardar}" th:object="${newProduct}" method="post"
						enctype="multipart/form-data" class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Nuevo Producto</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<input type="hidden" th:field="*{id}">
							<div class="mb-3">
								<label class="form-label">Nombre</label>
								<input type="text" class="form-control" th:field="*{nombreProducto}" required>
							</div>
							<div class="mb-3">
								<label class="form-label">Descripción</label>
								<textarea class="form-control" th:field="*{descripcion}" required></textarea>
							</div>
							<div class="mb-3">
								<label class="form-label">Precio</label>
								<input type="number" step="0.01" class="form-control" th:field="*{precio}" required>
							</div>
							<div class="form-check">
								<input class="form-check-input" type="checkbox" th:field="*{disponible}">
								<label class="form-check-label">Disponible</label>
							</div>
							<div class="mb-3">
								<label class="form-label">Categoria</label>
								<select th:field="*{categoria.id}" required>
									<option value="" disabled selected>Selecciona una categoría</option>
									<option th:each="cat : ${categorias}" th:value="${cat.id}" th:text="${cat.nombre}">
									</option>
								</select>
							</div>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-success">Guardar</button>
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Modales Editar Producto -->
			<div th:each="producto : ${products}">
				<div class="modal fade" th:id="'productoModalEdit' + ${producto.id}" tabindex="-1" aria-hidden="true">
					<div class="modal-dialog modal-lg">
						<form th:action="@{/admin/menu/productos/guardar}" th:object="${newProduct}" method="post"
							enctype="multipart/form-data" class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Editar Producto</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
							</div>
							<div class="modal-body">
								<input type="hidden" name="id" th:value="${newProduct.id}">

								<div class="mb-3">
									<label class="form-label">Nombre</label>
									<input type="text" class="form-control" name="nombreProducto"
										th:value="${nombreProducto}" required>

								</div>
								<div class="mb-3">
									<label class="form-label">Descripción</label>
									<input type="text" class="form-control" name="descripcion"
										th:value="${newProduct != null ? newProduct.descripcion : ''}" required>

								</div>
								<div class="mb-3">
									<label class="form-label">Precio</label>
									<input type="number" step="0.01" class="form-control" th:field="*{precio}"
										th:value="${newProduct.precio}" required>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" th:field="*{disponible}">
									<label class="form-check-label">Disponible</label>
								</div>
								<div class="mb-3">
									<label class="form-check-label">Categoria</label>
									<select th:field="*{categoria.id}" required>
										<option value="" disabled selected>Selecciona una categoría</option>
										<option th:each="cat : ${categorias}" th:value="${cat.id}"
											th:text="${cat.nombre}">
										</option>
									</select>
								</div>
							</div>
							<div class="modal-footer">
								<button type="submit" class="btn btn-success">Guardar Cambios</button>
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal">Cancelar</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</section>

	</section>
</body>

</html>