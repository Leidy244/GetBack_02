<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
	<section th:fragment="perfil" class="content-section">

		<!-- Header del perfil -->
		<div class="section-header">
			<h2><i class="fas fa-user-circle"></i> Mi Perfil</h2>
		</div>

		<!-- Información del usuario -->
		<div class="content-col">
			<div class="content-card">
				<div class="card-header">
				</div>
				<div class="card-body">
					<div class="account-info">
						<div class="user-display">
							<div class="avatar" id="avatar">
								<!-- Foto Perfil -->
								<img th:if="${usuario.foto != null}" th:src="@{'/images/' + ${usuario.foto}}
							" alt="Foto de perfil" style="width:100px;height:100px;border-radius:50%;object-fit:cover;" />

								<!-- Iniciales -->
								<div th:if="${usuario.foto == null}"
									style="width:100px;height:100px;border-radius:50%;background:#ccc;display:flex;align-items:center;justify-content:center;font-size:36px;">
									<span th:if="${usuario.nombre != null and usuario.apellido != null}"
										th:text="${#strings.substring(usuario.nombre,0,1) + #strings.substring(usuario.apellido,0,1)}">
										AP
									</span>
									<span th:if="${usuario.nombre == null or usuario.apellido == null}">AP</span>
								</div>
							</div>

							<div class="user-details">

								<h3 id="adminName" th:text="${usuario.nombre}">Admin Principal</h3>
								<div class="notice" th:text="${usuario.apellido}">Guerrero</div>
								<div class="notice" id="adminEmail" th:text="${usuario.correo}">
									admin@getback.com
								</div>
								<div class="notice" th:text="${usuario.direccion}">Dirección aquí</div>
								<div class="notice" id="adminPhone" th:text="${usuario.telefono}">+57 300 000
									0000
								</div>
								<small>Último acceso: <span id="ultimo-acceso">Hoy</span></small>
							</div>

							<div class="account-actions">
								<button type="button" id="btnEditProfile" class="dropdown-item"><i
										class="fas fa-user-edit"></i> Editar Perfil
								</button>
								<button class="btn ghost" id="btnChangePhoto">Cambiar foto</button>
							</div>
							<!----------Formulario para editar info-->
							<div id="formEditar" style="display:none; margin-top:20px;">
								<div class="card">

									<form th:action="@{/actualizar-datos}" th:object="${usuario}" method="post">
										<input type="hidden" th:field="*{id}" />

										<label>Nombres:</label>
										<input type="text" th:field="*{nombre}" />

										<label>Apellidos:</label>
										<input type="text" th:field="*{apellido}" />

										<label>Correo:</label>
										<input type="email" th:field="*{correo}" />

										<label>Dirección:</label>
										<input type="text" th:field="*{direccion}" />

										<label>Teléfono:</label>
										<input type="text" th:field="*{telefono}" />

										<label>Clave:</label>
										<input type="password" th:field="*{clave}" />

										<button type="submit">Guardar cambios</button>
										<button type="button" id="btnCancelEdit">Cancelar</button>
									</form>

								</div>
							</div>

							<!-- Formulario para cambiar foto -->

							<div id="formFoto" style="display:none; margin-top:20px;">
								<div class="card">

									<form th:action="@{/actualizar-foto}" method="post" enctype="multipart/form-data"
										class="form-foto">
										<input type="hidden" th:value="${usuario.id}" name="id" />

										<input type="file" id="inputFoto" name="foto" accept="image/*" required
											style="display: none;" />

										<label for="inputFoto" class="btnArchivo">Seleccionar imagen</label>
										<span id="nombreArchivo" class="nombre-archivo">Ningún archivo
											seleccionado</span>
										<br>
										<button type="submit" class="btnGuardarFoto">Actualizar Foto</button>
										<button type="button" id="cancelFoto" class="btnCancelarFoto">Cancelar</button>
									</form>
								</div>
							</div>
							<script>


								// Referencias a los formularios
								const formEditar = document.getElementById("formEditar");
								const formFoto = document.getElementById("formFoto");

								// Botones
								const btnEditProfile = document.getElementById("btnEditProfile");
								const btnChangePhoto = document.getElementById("btnChangePhoto");
								const btnCancelEdit = document.getElementById("btnCancelEdit");
								const btnCancelFoto = document.getElementById("cancelFoto");

								// --- Abrir Formulario de Edición ---
								btnEditProfile.addEventListener("click", () => {
									// Cierra el de foto si está abierto
									formFoto.style.display = "none";

									// Alterna el de edición
									formEditar.style.display = formEditar.style.display === "block" ? "none" : "block";
								});

								// --- Abrir Formulario de Foto ---
								btnChangePhoto.addEventListener("click", () => {
									// Cierra el de edición si está abierto
									formEditar.style.display = "none";

									// Alterna el de foto
									formFoto.style.display = formFoto.style.display === "block" ? "none" : "block";
								});

								// --- Cerrar ambos ---
								btnCancelEdit.addEventListener("click", () => {
									formEditar.style.display = "none";
								});

								btnCancelFoto?.addEventListener("click", () => {
									formFoto.style.display = "none";
								});

								// --- Nombre de la imagen seleccionada ---
								document.addEventListener("DOMContentLoaded", () => {
									const inputFoto = document.getElementById("inputFoto");
									const nombreArchivo = document.getElementById("nombreArchivo");

									if (inputFoto && nombreArchivo) {
										inputFoto.addEventListener("change", () => {
											const archivo = inputFoto.files[0];
											nombreArchivo.textContent = archivo
												? archivo.name
												: "Ningún archivo seleccionado";
										});
									}
								});
							</script>

</html>