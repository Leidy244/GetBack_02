<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<body>
<section class="content-section" th:fragment="inventario_movimientos">

    <div class="section-header mb-3">
        <h2><i class="fas fa-clipboard-list me-2"></i>Movimientos de Inventario</h2>
       
        <div class="input-group mt-2 ms-0" style="max-width: 360px; margin-left: 0;">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="movFilterInput" class="form-control" placeholder="Filtrar por remisión, producto o proveedor..." oninput="movFilterApply()" onkeyup="movFilterApply()" aria-label="Filtro movimientos">
        </div>
    </div>

    

    <form th:action="@{/inventario/movimientos}" method="get" class="row g-2 align-items-end mb-3">
        <div class="col-sm-6 col-md-3">
            <label class="form-label">Desde</label>
            <input type="date" class="form-control" name="desde" th:value="${desde != null ? #temporals.format(desde, 'yyyy-MM-dd') : ''}">
        </div>
        <div class="col-sm-6 col-md-3">
            <label class="form-label">Hasta</label>
            <input type="date" class="form-control" name="hasta" th:value="${hasta != null ? #temporals.format(hasta, 'yyyy-MM-dd') : ''}">
        </div>
        <div class="col-sm-12 col-md-6 d-flex justify-content-between align-items-end gap-2">
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-outline-primary">Filtrar</button>
                <a th:href="@{/inventario/movimientos}" class="btn btn-outline-secondary">Limpiar</a>
            </div>
            <div class="btn-group" role="group" aria-label="Paginación">
                <a class="btn btn-outline-secondary"
                   th:classappend="${page <= 1} ? ' disabled' : ''"
                   th:href="@{/inventario/movimientos(page=${page > 1 ? page - 1 : 1}, size=${size}, desde=${desde}, hasta=${hasta})}">«</a>
                <a class="btn"
                   th:each="p : ${#numbers.sequence(1, totalPages)}"
                   th:classappend="${p == page} ? 'btn-primary' : 'btn-outline-secondary'"
                   th:text="${p}"
                   th:href="@{/inventario/movimientos(page=${p}, size=${size}, desde=${desde}, hasta=${hasta})}"></a>
                <a class="btn btn-outline-secondary"
                   th:classappend="${page >= totalPages} ? ' disabled' : ''"
                   th:href="@{/inventario/movimientos(page=${page < totalPages ? page + 1 : totalPages}, size=${size}, desde=${desde}, hasta=${hasta})}">»</a>
            </div>
        </div>
    </form>

   
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                    <tr>
                        <th></th>
                        <th>Fecha remisión</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Proveedor</th>
                        <th>Teléfono</th>
                        <th>Fecha ingreso</th>
                        <th>Observaciones</th>
                    </tr>
                    </thead>
                    <tbody id="movimientosTableBody">
                    <tr th:each="h : ${ingresosInventario}" data-row="mov">
                        <td th:text="${h.remision != null ? h.remision : '—'}"></td>
                        <td th:text="${h.fechaRemision != null ? #temporals.format(h.fechaRemision, 'dd/MM/yyyy') : '—'}"></td>
                        <td th:text="${h.producto != null ? h.producto : '—'}"></td>
                        <td th:text="${h.cantidad != null ? h.cantidad : 0}"></td>
                        <td th:text="${h.proveedor != null && !h.proveedor.isEmpty() ? h.proveedor : '—'}"></td>
                        <td th:text="${h.telefonoProveedor != null && !h.telefonoProveedor.isEmpty() ? h.telefonoProveedor : '—'}"></td>
                        <td th:text="${h.fechaIngreso != null ? #temporals.format(h.fechaIngreso, 'dd/MM/yyyy HH:mm') : '—'}"></td>
                        <td th:text="${h.observaciones != null && !h.observaciones.isEmpty() ? h.observaciones : '—'}"></td>
                    </tr>
                    <tr th:if="${ingresosInventario == null or ingresosInventario.isEmpty()}">
                        <td colspan="8" class="text-center text-muted py-4">Sin movimientos.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</section>
<script>
  (function(){
    function run(){
      const input = document.getElementById('movFilterInput');
      const tbody = document.getElementById('movimientosTableBody');
      if(!tbody) return;
      function getText(r){
        const tds = r.querySelectorAll('td');
        const rem = tds[0] ? (tds[0].textContent || '') : '';
        const prod = tds[2] ? (tds[2].textContent || '') : '';
        const prov = tds[4] ? (tds[4].textContent || '') : '';
        return (rem + ' ' + prod + ' ' + prov).toLowerCase();
      }
      function apply(){
        const q = ((input && input.value) || '').toLowerCase().trim();
        const rows = Array.from(tbody.querySelectorAll('tr[data-row="mov"]'));
        if(!q){ rows.forEach(r => r.style.display = ''); return; }
        rows.forEach(r => { r.style.display = getText(r).includes(q) ? '' : 'none'; });
      }
      window.movFilterApply = apply;
      if(input){ input.addEventListener('input', apply); input.addEventListener('keyup', apply); }
      apply();
    }
    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', run);
    } else { run(); }
  })();
</script>
