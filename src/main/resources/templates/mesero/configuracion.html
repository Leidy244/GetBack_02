<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Perfil del Mesero</title>
	<link rel="icon" type="image/png" th:href="@{/images/Logo_Ignitia.png}">
	<link rel="stylesheet" th:href="@{/css/configuracionMesero.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
	<header class="header">
		<div class="logo-desktop">
			<a th:href="@{/configuracion}">
				<img th:src="@{~/images/Logo_principal.png}" width="100" alt="Logo Get Back">
			</a>
		</div>
		<h2>Perfil del Mesero</h2>
		<!-- Botón de menú hamburguesa Responsive -->
		<div class="hamburger" id="hamburger">
			<span></span>
			<span></span>
			<span></span>
		</div>
		<!-- Contenedor principal de botones de navegación -->
		<div class="container">
			<nav class="nav-btn-wrapper" id="navMenu" aria-label="Menú de configuración del mesero">

				<a th:href="@{/mesero}" class="nav-btn">
					<i class="fa-solid fa-utensils"></i>
					<span>Tomar Pedido</span>
				</a>

				<a th:href="@{/estadisticas}" class="nav-btn">
					<i class="fas fa-chart-bar"></i>
					<span>Estadísticas</span>
				</a>

				<a th:href="@{/historial}" class="nav-btn">
					<i class="fas fa-history"></i>
					<span>Historial</span>
				</a>

				<a href="#" class="nav-btn" id="openSettingsBtn">
					<i class="fa-solid fa-gear"></i>
					<span>Configuración</span>
				</a>

				<a href="#" class="nav-btn" id="logoutMesero">
					<i class="fa-solid fa-arrow-right-from-bracket"></i>
					<span>Cerrar sesión</span>
				</a>
			</nav>
		</div>
	</header>

	<!-- Información -->
	<div class="content-col">
		<div class="content-card">
			<div class="card-body">
				<div class="account-info" th:if="${session.usuarioLogueado != null}">
					<div class="user-display">
						<!-- FOTO -->
						<div class="avatar" id="avatar">
							<img th:if="${session.usuarioLogueado != null and session.usuarioLogueado.foto != null}"
								th:src="@{'/images/' + ${session.usuarioLogueado.foto}}" alt="Foto de perfil" />
							<div th:if="${session.usuarioLogueado != null and session.usuarioLogueado.foto == null}" class="avatar-placeholder">
								<span th:text="${#strings.substring(session.usuarioLogueado.nombre,0,1) + 
										#strings.substring(session.usuarioLogueado.apellido,0,1)}">AD</span>
							</div>
						</div>

						<!-- DATOS -->
						<div class="user-details">
							<h3 th:text="${session.usuarioLogueado.nombre + ' ' + session.usuarioLogueado.apellido}">
							</h3>
							<p th:text="${session.usuarioLogueado.correo}"></p>
							<p th:text="${session.usuarioLogueado.telefono}"></p>
							<p th:text="${session.usuarioLogueado.direccion}"></p>

							<!-- INFORMACIÓN DEL TURNO -->
							<div class="turno-info"
								style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
								<h4 style="margin: 0 0 8px 0; color: #007bff; font-size: 16px;">
									<i class="fas fa-calendar-alt me-2"></i><span>Turno Asignado</span>
								</h4>
								<div th:if="${session.usuarioLogueado.fecha != null}">
									<p style="margin: 5px 0; font-weight: 500;">
										<strong>Fecha:</strong>
										<span th:text="${#temporals.format(session.usuarioLogueado.fecha, 'dd/MM/yyyy')}"></span>
									</p>
									<p style="margin: 5px 0; font-weight: 500;">
										<strong>Horario:</strong>
										<span
											th:text="${session.usuarioLogueado.horaInicio} + ' - ' + ${session.usuarioLogueado.horaFin}"></span>
									</p>
								</div>
								<div th:if="${session.usuarioLogueado.fecha == null}">
									<p style="margin: 5px 0; color: #6c757d; font-style: italic;">
										No hay turno asignado actualmente
									</p>
								</div>
							</div>

							<small><span>Último acceso:</span> <span id="ultimo-acceso">Hoy</span></small>
						</div>

						<!-- BOTONES -->
						<div class="account-actions" style="display:flex; gap:10px; margin-left:auto;">
							<button type="button" id="btnEditProfile" class="dropdown-item">
								<i class="fas fa-user-edit"></i> <span>Editar Perfil</span>
							</button>
							<button type="button" id="btnChangePhoto" class="dropdown-item">
								<i class="fas fa-camera"></i> <span>Cambiar Foto</span>
							</button>
						</div>
					</div>

					<!-- FORMULARIO EDITAR -->
					<form id="formEditar" th:action="@{/actualizar-datos-mesero}" method="post" style="display:none;">
						<input type="hidden" name="id" th:value="${session.usuarioLogueado.id}" />

						<label>Nombres:</label>
						<input type="text" name="nombre" th:value="${session.usuarioLogueado.nombre}" />

						<label>Apellidos:</label>
						<input type="text" name="apellido" th:value="${session.usuarioLogueado.apellido}" />

						<label>Correo:</label>
						<input type="email" name="correo" th:value="${session.usuarioLogueado.correo}" />

						<label>Dirección:</label>
						<input type="text" name="direccion" th:value="${session.usuarioLogueado.direccion}" />

						<label>Teléfono:</label>
						<input type="text" name="telefono" th:value="${session.usuarioLogueado.telefono}" />

						<label>Clave:</label>
						<input type="password" name="clave" th:value="${session.usuarioLogueado.clave}" />

						<div style="margin-top:10px; display:flex; gap:10px;">
							<button type="submit" class="btn">Guardar cambios</button>
							<button type="button" id="btnCancelEdit" class="btn ghost">Cancelar</button>
						</div>
					</form>
					<!-- FORMULARIO FOTO -->
					<div id="formFoto" style="display:none; margin-top:20px;">
						<div class="card">
							<form th:action="@{/actualizar-foto-mesero}" method="post" enctype="multipart/form-data">
								<input type="hidden" name="id" th:value="${session.usuarioLogueado.id}" />

								<input type="file" id="inputFoto" name="foto" accept="image/*" required
									style="display:none;" />

								<label for="inputFoto" class="btnArchivo">Seleccionar imagen</label>
								<span id="nombreArchivo" class="nombre-archivo">Ningún archivo seleccionado</span>
								<br>
								<div style="margin-top:10px; display:flex; gap:10px;">
									<button type="submit" class="btnGuardarFoto">Actualizar Foto</button>
									<button type="button" id="cancelFoto" class="btnCancelarFoto">Cancelar</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Botón Modo Oscuro -->
	<button class="dark-mode-toggle" id="darkModeToggle">
		<i class="fas fa-moon"></i>
	</button>

	<!-- Modal de Configuración -->
	<div class="settings-modal" id="settingsModal">

		<div class="settings-content">
			<span class="close-settings" id="closeSettings">&times;</span>
			<h2><i class="fa-solid fa-sliders"></i> Configuración</h2>

			<!-- Eliminado bloque de idioma -->

			<div class="setting-item">
				<label>
					<i class="fa-solid fa-bell"></i> <span>Notificaciones</span>
					<input type="checkbox" id="notificacionesSwitch">
				</label>
			</div>

			<div class="setting-item">
				<label for="contrastRange">
					<i class="fa-solid fa-circle-half-stroke"></i> <span>Contraste</span>
				</label>
				<div class="contrast-control">
					<span>Bajo</span>
					<input type="range" id="contrastRange" min="0" max="2" step="1">
					<span>Alto</span>
				</div>
			</div>

			<div class="setting-item">
				<label>
					<i class="fa-solid fa-palette"></i> <span>Tema de colores</span>
				</label>
				<select id="themeSelect">
					<option value="default">Morado / Turquesa (predeterminado)</option>
					<option value="azul">Azules</option>
					<option value="verde">Verdes</option>
					<option value="rojo">Morados</option>
					<option value="dorado">Dorados</option>
					<option value="rosa">Rosados</option>
					<option value="gris">Grises</option>
				</select>
			</div>

			<div class="setting-item">
				<label>
					<i class="fa-solid fa-text-height"></i> <span>Tamaño de fuente</span>
				</label>
				<select id="fontSizeSelect">
					<option value="pequeno">Pequeño</option>
					<option value="mediano">Mediano</option>
					<option value="grande">Grande</option>
				</select>
			</div>
			<button type="button" class="save-btn" id="saveSettingsBtn">Guardar cambios</button>
		</div>
	</div>

</body>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:src="@{/js/ConfigMesero.js}" defer></script>

</html>