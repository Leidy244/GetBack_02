<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Factura GET BACK</title>
    <style>
        /* Configuración de página para impresión térmica */
        @page {
            size: 58mm auto;
            margin: 0;
        }
        
        /* Estilos generales */
        body {
            font-family: 'Courier New', monospace;
            width: 58mm;
            margin: 4mm auto;
            font-size: 20px;
            font-weight: 700;
            line-height: 1.2;
        }
        
        /* Encabezado */
        .header {
            text-align: center;
            margin-bottom: 6px;
        }
        
        .titulo {
            margin: 0 0 6px 0;
            font-size: 22px;
            text-align: center;
        }
        
        .subtitulo {
            color: #666;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        /* Información de mesa y fecha */
        .info-mesa {
            color: #666;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        /* Tabla de productos */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
        }
        
        th, td {
            padding: 6px 0;
            border-bottom: 1px dashed #ccc;
            font-size: 20px;
            font-weight: 700;
            vertical-align: top;
        }
        
        .text-end {
            text-align: right;
        }
        
        /* Detalles del producto */
        .item-detalle {
            width: 70%;
            padding-right: 5px;
        }
        
        .item-precio {
            width: 30%;
            padding-left: 5px;
        }
        
        .cantidad {
            font-weight: 700;
            margin-right: 8px;
            display: inline-block;
            min-width: 25px;
        }
        
        /* Separadores */
        hr {
            border: none;
            border-top: 1px dashed #ccc;
            margin: 10px 0;
        }
        
        /* Total */
        .total {
            text-align: right;
            margin: 10px 0;
            font-size: 22px;
        }
        
        /* Pie de página */
        .footer {
            text-align: center;
            color: #666;
            font-size: 16px;
            font-weight: 700;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
        }
    </style>
</head>
<body>
    <!-- El contenido se insertará dinámicamente con JavaScript -->
    <div id="ticket-content"></div>
    
    <script>
        // Función para generar el contenido del ticket
        function generarTicket(data) {
            const filas = data.items.map(item => {
                const subtotal = (item.precio || 0) * (item.cantidad || 1);
                return `
                <tr>
                    <td class="item-detalle">
                        <span class="cantidad">${item.cantidad || 1}x</span> ${item.nombre || 'Item'}
                    </td>
                    <td class="item-precio text-end">$${subtotal.toLocaleString('es-CO')}</td>
                </tr>`;
            }).join('');
            
            const contenido = `
            <div class="header">
                <h1 class="titulo">GET BACK</h1>
                <div class="subtitulo">Factura</div>
            </div>
            <div class="info-mesa">
                <div>Mesa: ${data.mesa || '—'}</div>
                <div>${data.fecha}</div>
            </div>
            <hr/>
            <table>
                <thead>
                    <tr>
                        <th>Detalle</th>
                        <th class="text-end">Subtotal</th>
                    </tr>
                </thead>
                <tbody>${filas}</tbody>
            </table>
            <hr/>
            <div class="total">
                <strong>Total: $${Number(data.total || 0).toLocaleString('es-CO')}</strong>
            </div>
            <div class="footer">
                Gracias por su compra
            </div>`;
            
            document.getElementById('ticket-content').innerHTML = contenido;
        }
        
        // Imprimir automáticamente
        window.onload = function() {
            // Obtener datos de la URL o localStorage
            const ticketData = JSON.parse(localStorage.getItem('ticketData') || '{}');
            
            if (ticketData.items) {
                generarTicket(ticketData);
                
                // Pequeño delay antes de imprimir
                setTimeout(() => {
                    window.print();
                }, 200);
            }
        };
        
        // Cerrar después de imprimir
        window.onafterprint = function() {
            setTimeout(() => {
                window.close();
                localStorage.removeItem('ticketData');
            }, 500);
        };
    </script>
</body>
</html>