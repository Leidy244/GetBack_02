<section th:fragment="inicio-caja" class="content-section">
	<div class="dashboard-container">
		<!-- Header de la sección -->
        <div class="section-header caja-dashboard-header">
            <div class="caja-dashboard-left">
                <h2>Panel de Control</h2>
                <p class="caja-dashboard-subtitle">Resumen general de la caja</p>
            </div>
            <div class="caja-dashboard-right">
                <div class="date-badge caja-date-badge" title="Fecha y hora actuales">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="dashboardDate"></span>
                </div>
                <span class="caja-status-badge" th:classappend="${cajaAbierta} ? ' open' : ' closed'">
                      <i class="fas status-icon" th:classappend="${cajaAbierta} ? ' fa-check-circle' : ' fa-lock'"></i>
                      <span th:text="${cajaAbierta} ? 'Caja abierta' : 'Caja cerrada'">Caja abierta</span>
                </span>
            </div>
        </div>

        <!-- Fila: formulario a la izquierda, tarjetas a la derecha -->
        <div class="row mt-2 mb-2 g-3 align-items-stretch justify-content-center dashboard-top">
            <!-- Izquierda: Formulario de gastos -->
            <div class="col-12 col-lg-7 ps-lg-0">
                <div class="card shadow-sm border-0 h-100 gastos-card">
                    <div class="card-header"><i class="fas fa-wallet"></i> Gastos</div>
                    <div class="card-body">
                        <form id="gastosForm" th:action="@{/caja/gastos/registrar}" method="post" autocomplete="off">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Concepto</label>
                                    <input type="text" class="form-control" placeholder="Ej: Compra de insumos" name="concepto" required>
                                </div>
                                <div class="col-12 col-md-3">
                                    <label class="form-label">Fecha de ingreso</label>
                                    <div class="form-control" id="fechaTrabajoText" style="pointer-events:none;">
                                        Hoy
                                    </div>
                                    <input type="hidden" name="fecha" id="gastoFechaHidden" th:value="${#temporals.format(T(java.time.LocalDate).now(),'yyyy-MM-dd')}">
                                </div>
                                <div class="col-12 col-md-3">
                                    <label class="form-label">Monto</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" name="monto" step="0.01" min="0" placeholder="0.00" required>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <label class="form-label">Método</label>
                                    <select class="form-select" name="metodo" required>
                                        <option value="EFECTIVO">Efectivo</option>
                                        <option value="TARJETA">Tarjeta</option>
                                        <option value="TRANSFERENCIA">Transferencia</option>
                                    </select>
                                </div>
                                <div class="col-12 col-md-8">
                                    <label class="form-label">Nota</label>
                                    <input type="text" class="form-control" name="nota" placeholder="Información adicional (opcional)">
                                </div>
                            </div>
                            <div class="d-flex gap-2 mt-3">
                                <button type="submit" class="btn btn-primary px-3"><i class="fas fa-plus me-2"></i>Registrar Gasto</button>
                                <button type="reset" class="btn btn-secondary px-3">Limpiar</button>
                                <button type="button" class="btn btn-outline-primary px-3" id="btnGastosHistorial"><i class="fas fa-history me-2"></i>Historial de gastos</button>
                            </div>
                        </form>
                        <div class="gastos-summary">
                            <div class="gastos-summary-title">Últimos gastos</div>
                            <div class="gastos-table-wrapper">
                                <div class="table-responsive">
                                    <table class="table table-hover gastos-table">
                                        <thead>
                                            <tr>
                                                <th>Concepto</th>
                                                <th>Fecha</th>
                                                <th>Método</th>
                                                <th>Nota</th>
                                                <th class="text-end">Monto</th>
                                            </tr>
                                        </thead>
                                        <tbody th:if="${ultimosGastos != null}">
                                            <tr th:each="g : ${ultimosGastos}">
                                                <td>
                                                    <i class="fas fa-receipt me-2"></i>
                                                    <span th:text="${g.concepto}">Concepto</span>
                                                </td>
                                                <td th:text="${#temporals.format(g.fecha,'dd/MM/yyyy')}">01/01/2025</td>
                                                <td th:text="${g.metodo}">EFECTIVO</td>
                                                <td th:text="${g.nota}">—</td>
                                                <td class="text-end">
                                                    <span class="monto-badge" th:text="'$' + ${#numbers.formatDecimal(g.monto,1,'COMMA',2,'POINT')}">$0.00</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tbody th:if="${ultimosGastos == null}">
                                            <tr>
                                                <td><i class="fas fa-receipt me-2"></i> Compra de insumos</td>
                                                <td>Hoy</td>
                                                <td>EFECTIVO</td>
                                                <td>—</td>
                                                <td class="text-end"><span class="monto-badge">$0.00</span></td>
                                            </tr>
                                            <tr>
                                                <td><i class="fas fa-receipt me-2"></i> Transporte</td>
                                                <td>Ayer</td>
                                                <td>TARJETA</td>
                                                <td>—</td>
                                                <td class="text-end"><span class="monto-badge">$0.00</span></td>
                                            </tr>
                                            <tr>
                                                <td><i class="fas fa-receipt me-2"></i> Otros</td>
                                                <td>Esta semana</td>
                                                <td>TRANSFERENCIA</td>
                                                <td>—</td>
                                                <td class="text-end"><span class="monto-badge">$0.00</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Derecha: Tarjetas resumen listadas -->
            <div class="col-12 col-lg-5 pe-lg-0">
                <div class="stats-list-right">
            <a th:href="@{/caja(section='historial-pagos')}" class="stat-card stat-card-link" title="Ver historial de pagos">
                <div class="stat-icon bg-primary"><i class="fas fa-dollar-sign"></i></div>
                <div class="stat-info">
                    <h3 th:text="'$' + ${#numbers.formatDecimal(ingresosHoy, 1, 'COMMA', 2, 'POINT')}">$0.00</h3>
                    <p>Ventas Hoy</p>
                    <small th:text="${ventasHoy} + ' ventas'">0 ventas</small>
                </div>
            </a>
        
            <a th:href="@{/caja(section='pedidos')}" class="stat-card stat-card-link" title="Ver pedidos pendientes y completados">
                <div class="stat-icon bg-warning"><i class="fas fa-undo"></i></div>
                <div class="stat-info">
                    <h3 th:text="${pedidosPendientes}">0</h3>
                    <p>Pedidos Pendientes</p>
                    <small>Pedidos en proceso</small>
                </div>
            </a>
        
            <a th:href="@{/caja(section='pagos')}" class="stat-card stat-card-link" title="Ir a pedidos pendientes de cobro">
                <div class="stat-icon bg-success"><i class="fas fa-list"></i></div>
                <div class="stat-info">
                    <h3 th:text="${pedidosPendientesPago}">0</h3>
                    <p>Pedidos por cobrar</p>
                    <small th:text="${pedidosPendientesPago} + ' pedidos pendientes'">0 pedidos pendientes</small>
                </div>
            </a>
                </div>
            </div>
        </div>
	</div>
</section>
