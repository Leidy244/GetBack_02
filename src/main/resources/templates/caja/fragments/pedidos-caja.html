<section th:fragment="pedidos" class="content-section">
	<div class="dashboard-container">
		<div class="section-header caja-dashboard-header">
			<div class="caja-dashboard-left">
				<h2><i class="fas fa-list-alt"></i> Gestión de pedidos</h2>
				<p class="caja-dashboard-subtitle">Pedidos generados y completados</p>
			</div>
		</div>

		<!-- Sección 1: Pedidos generados (pendientes) -->
		<div class="pedidos-section mb-4">
			<h3 class="pedidos-section-title"><i class="fas fa-list-alt"></i> Pedidos generados </h3>

			<div class="pedidos-grid" th:if="${pedidosPendientesBar != null and !#lists.isEmpty(pedidosPendientesBar)}">
				<div class="pedido-card pedido-card-pendiente"
					 th:each="pago, iStat : ${pedidosPendientesBar}"
					 th:attr="data-pedido-id=${pago.id}">

					<div class="pedido-card-header">
						<div>
                            <span class="pedido-mesa" th:text="${pago.labelMesa}">Mesa</span>
							<span class="pedido-fecha"
							      th:text="${#temporals.format(pago.fechaCreacion, 'dd/MM/yyyy HH:mm')}"
							      th:title="${pago.fechaCreacion}">12/11/2025 18:30</span>
						</div>
						<div class="pedido-total" th:text="${#strings.concat('$', #numbers.formatDecimal(pago.total, 0, 'POINT', 0, 'POINT'))}">$0</div>
					</div>

					<div class="pedido-card-body">
						<div class="pedido-detalle-resumen">
							<button type="button" class="btn btn-link p-0 text-start ver-detalle-pago"
                                    th:attr="data-pedido-id=${pago.id}, 
                                             data-mesa=${pago.labelMesa},
                                             data-total=${pago.total},
                                             data-detalle=${pago.orden}">
								<span class="detalle-resumen-text">
									Ver detalle del pedido
								</span>
							</button>
						</div>
						<div class="pedido-acciones">
							<span class="badge bg-warning"
								  th:text="${pago.estado != null ? pago.estado.nombreEstado : 'PENDIENTE'}">PENDIENTE</span>

							<form th:action="@{/caja/marcar-completado}" method="post" class="d-inline">
								<input type="hidden" name="pedidoId" th:value="${pago.id}" />
								<input type="hidden" name="section" value="pedidos" />
								<button type="submit" class="btn btn-success btn-sm">
									<i class="fas fa-check"></i> Completado
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>

			<div class="pedidos-empty" th:if="${pedidosPendientesBar == null or #lists.isEmpty(pedidosPendientesBar)}">
				<i class="fas fa-check-circle"></i>
				<p>No hay pedidos generados pendientes.</p>
			</div>
		</div>

		<!-- Sección 2: Pedidos completados (pagados) -->
		<div class="pedidos-section">
			<h3 class="pedidos-section-title"><i class="fas fa-clipboard-check"></i> Pedidos completados</h3>

			<div class="pedidos-grid" th:if="${pedidosPagadosBar != null and !#lists.isEmpty(pedidosPagadosBar)}">
				<div class="pedido-card pedido-card-completado collapsed"
					 th:each="pago, iStat : ${pedidosPagadosBar}"
					 th:attr="data-pedido-id=${pago.id}">

					<div class="pedido-card-header pedido-toggle">
						<div>
                            <span class="pedido-mesa" th:text="${pago.labelMesa}">Mesa</span>
							<span class="pedido-fecha"
							      th:text="${#temporals.format(pago.fechaCreacion, 'dd/MM/yyyy HH:mm')}"
							      th:title="${pago.fechaCreacion}">12/11/2025 18:30</span>
						</div>
						<div class="pedido-total" th:text="${#strings.concat('$', #numbers.formatDecimal(pago.total, 0, 'POINT', 0, 'POINT'))}">$0</div>
						<button type="button" class="pedido-toggle-btn" aria-label="Mostrar/ocultar detalle">
							<i class="fas fa-chevron-down"></i>
						</button>
					</div>

					<div class="pedido-card-body">
						<div class="pedido-detalle-resumen">
							<button type="button" class="btn btn-link p-0 text-start ver-detalle-pago"
                                    th:attr="data-origen='historial',
                                             data-pedido-id=${pago.id},
                                             data-mesa=${pago.labelMesa},
                                             data-total=${pago.total},
                                             data-recibido=${pago.montoRecibido},
                                             data-cambio=${pago.cambio},
                                             data-detalle=${pago.orden}">
								<span class="detalle-resumen-text">
									Ver detalle del pedido
								</span>
							</button>
						</div>
						<div class="pedido-acciones">
							<span class="badge bg-success"
								  th:text="${pago.estado != null ? pago.estado.nombreEstado : 'COMPLETADO'}">COMPLETADO</span>

							<form th:action="@{/caja/marcar-completado}" method="post" class="d-inline">
								<input type="hidden" name="pedidoId" th:value="${pago.id}" />
								<input type="hidden" name="section" value="pedidos" />
								<input type="hidden" name="accion" value="revertir" />
								<button type="submit" class="btn btn-warning btn-sm">
									<i class="fas fa-undo"></i> Marcar como pendiente
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>

			<div class="pedidos-empty" th:if="${pedidosPagadosBar == null or #lists.isEmpty(pedidosPagadosBar)}">
				<i class="fas fa-inbox"></i>
				<p>Aún no hay pedidos completados de BAR.</p>
			</div>
		</div>
	</div>
</section>
