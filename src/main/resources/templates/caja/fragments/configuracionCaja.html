<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
	<section th:fragment="configuracionCaja" class="content-section">
		<!-- Header -->
		<div class="section-header">
			<h2>
				<i class="fas fa-user-shield"></i>
				<span>Perfil del Cajero</span>
				<button type="button" class="admin-settings-btn" id="adminSettingsBtn"
					title="Configuración de apariencia">
					<i class="fas fa-gear"></i>
					<span class="btn-text">Configuración</span>
				</button>
			</h2>
		</div>



		<!-- Información -->
		<div class="content-col">
			<div class="content-card">
				<div class="card-header">Cajero del sistema</div>
				<div class="card-body">
					<!-- Solo mostrar el contenido si existe usuarioLogueado en sesión -->
					<div class="account-info" th:if="${session.usuarioLogueado != null}">
						<div class="user-display row" style="gap:16px;">
							<!-- FOTO -->
							<div class="avatar col-auto" id="avatar">
								<img th:if="${session.usuarioLogueado != null and session.usuarioLogueado.foto != null}"
									th:src="@{'/images/' + ${session.usuarioLogueado.foto}}" alt="Foto de perfil"
									style="border-radius: 50%; object-fit: cover; width: 120px; height: 120px;" />
								<div th:if="${session.usuarioLogueado == null or session.usuarioLogueado.foto == null}"
									class="avatar-placeholder">
									<span
										th:text="${session.usuarioLogueado != null ? #strings.substring(session.usuarioLogueado.nombre,0,1) + #strings.substring(session.usuarioLogueado.apellido,0,1) : 'AD'}">
										AD
									</span>
								</div>
							</div>

							<!-- DATOS -->
							<div class="user-details col-lg-5 col-md-6 col-12">
								<h3
									th:text="${session.usuarioLogueado.nombre + ' ' + session.usuarioLogueado.apellido}">
								</h3>
								<p th:text="${session.usuarioLogueado.correo}"></p>
								<p th:text="${session.usuarioLogueado.telefono}"></p>
								<p th:text="${session.usuarioLogueado.direccion}"></p>

								<!-- INFORMACIÓN DEL TURNO -->
								<div class="turno-info">
									<h4>
										<i class="fas fa-calendar-alt me-2"></i><span>Turno Asignado</span>
									</h4>
									<div th:if="${session.usuarioLogueado.fecha != null}">
										<p>
											<strong>Fecha:</strong>
											<span
												th:text="${#temporals.format(session.usuarioLogueado.fecha, 'dd/MM/yyyy')}"></span>
										</p>
										<p>
											<strong>Horario:</strong>
											<span
												th:text="${session.usuarioLogueado.horaInicio} + ' - ' + ${session.usuarioLogueado.horaFin}"></span>
										</p>
									</div>
									<div th:if="${session.usuarioLogueado.fecha == null}">
										<p class="turno-info-empty">
											No hay turno asignado actualmente
										</p>
									</div>
								</div>

								<small>Último acceso: <span id="ultimo-acceso">Hoy</span></small>
								<div class="account-actions" style="display:flex; gap:10px; margin-left:auto;">
									<button type="button" id="btnEditProfile" class="btn btn-primary btn-sm">
										<i class="fas fa-user-edit"></i> <span>Editar Perfil</span>
									</button>
									<button type="button" id="btnChangePhoto" class="btn btn-primary btn-sm">
										<i class="fas fa-camera"></i> <span>Cambiar Foto</span>
									</button>
								</div>
							</div>
							<!-- FORMULARIO EDITAR (columna derecha) -->
							<div id="formEditar" class="col-lg-4 col-md-6 col-12" style="display:none;">
								<div class="content-card">
									<div class="card-header"><i class="fas fa-user-edit"></i> Editar perfil</div>
									<div class="card-body">
										<form th:action="@{/actualizar-datos-caja}" method="post">
											<input type="hidden" name="id" th:value="${session.usuarioLogueado.id}" />
											<div class="mb-2">
												<label class="form-label">Nombres</label>
												<input class="form-control" type="text" name="nombre"
													th:value="${session.usuarioLogueado.nombre}" />
											</div>
											<div class="mb-2">
												<label class="form-label">Apellidos</label>
												<input class="form-control" type="text" name="apellido"
													th:value="${session.usuarioLogueado.apellido}" />
											</div>
											<div class="mb-2">
												<label class="form-label">Correo</label>
												<input class="form-control" type="email" name="correo"
													th:value="${session.usuarioLogueado.correo}" />
											</div>
											<div class="mb-2">
												<label class="form-label">Dirección</label>
												<input class="form-control" type="text" name="direccion"
													th:value="${session.usuarioLogueado.direccion}" />
											</div>
											<div class="mb-2">
												<label class="form-label">Teléfono</label>
												<input class="form-control" type="text" name="telefono"
													th:value="${session.usuarioLogueado.telefono}" />
											</div>
											<div class="mb-2">
												<label class="form-label">Clave</label>
												<input class="form-control" type="password" name="clave"
													th:value="${session.usuarioLogueado.clave}" />
											</div>
											<div style="display:flex; gap:8px;">
												<button type="submit" class="btn btn-primary btn-sm">Guardar
													cambios</button>
												<button type="button" id="btnCancelEdit"
													class="btn btn-sm">Cancelar</button>
											</div>
										</form>
									</div>
								</div>
							</div>

							<!-- FORMULARIO FOTO (columna derecha) -->
							<div id="formFoto" class="col-lg-4 col-md-6 col-12" style="display:none; margin-top:20px;">
								<div class="content-card">
									<div class="card-header"><i class="fas fa-camera"></i> Cambiar foto</div>
									<div class="card-body">
										<form th:action="@{/actualizar-foto-caja}" method="post"
											enctype="multipart/form-data">
											<input type="hidden" name="id" th:value="${session.usuarioLogueado.id}" />
											<input type="file" id="inputFoto" name="foto" accept="image/*" required
												style="display:none;" />
											<label for="inputFoto" class="btnArchivo">Seleccionar imagen</label>
											<span id="nombreArchivo" class="nombre-archivo">Ningún archivo
												seleccionado</span>
											<br>
											<div style="margin-top:10px; display:flex; gap:10px;">
												<button type="submit" class="btnGuardarFoto">Actualizar Foto</button>
												<button type="button" id="cancelFoto"
													class="btnCancelarFoto">Cancelar</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>

		<!-- Modal de Configuración -->
		<div class="adminsettings-modal" id="adminsettingsModal">
			<div class="settings-content">
				<span class="close-settings" id="closeSettings">&times;</span>
				<h2><i class="fa-solid fa-sliders"></i> Configuración</h2>
				<div class="setting-item">
					<label>
						<i class="fa-solid fa-bell"></i> <span>Notificaciones</span>
						<input type="checkbox" id="notificacionesSwitch">
					</label>
				</div>
				<div class="setting-item">
					<label for="contrastRange">
						<i class="fa-solid fa-circle-half-stroke"></i> <span>Contraste</span>
					</label>
					<div class="contrast-control">
						<span>Bajo</span>
						<input type="range" id="contrastRange" min="0" max="2" step="1">
						<span>Alto</span>
					</div>
				</div>

				<div class="setting-item">
					<label>
						<i class="fa-solid fa-palette"></i> <span>Tema de colores</span>
					</label>
					<select id="themeSelect">
						<option value="default">Morado / Turquesa (predeterminado)</option>
						<option value="azul">Azules</option>
						<option value="verde">Verdes</option>
						<option value="rojo">Morados</option>
						<option value="dorado">Dorados</option>
						<option value="rosa">Rosados</option>
						<option value="gris">Grises</option>
					</select>
				</div>

				<div class="setting-item">
					<label>
						<i class="fa-solid fa-text-height"></i> <span>Tamaño de fuente</span>
					</label>
					<select id="fontSizeSelect">
						<option value="pequeno">Pequeño</option>
						<option value="mediano">Mediano</option>
						<option value="grande">Grande</option>
					</select>
				</div>
				<button type="button" class="save-btn" id="saveSettingsBtn">Guardar cambios</button>
			</div>
		</div>

	</section>
</body>

</html>