<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="historial-pagos">
    <div class="section-header">
        <h2><i class="fas fa-receipt"></i> Historial de Pagos</h2>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div></div>
        <div class="d-flex align-items-center gap-2">
            <label for="historial-orden" class="form-label mb-0">Ordenar por:</label>
            <select id="historial-orden" class="form-select form-select-sm" style="width: auto;">
                <option value="reciente" selected>Más reciente primero</option>
                <option value="viejo">Más viejo primero</option>
            </select>
        </div>
    </div>

    <div class="table-container">
        <table class="table table-striped" id="tabla-historial-pagos">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Mesa</th>
                    <th>Detalle</th>
                    <th>Total</th>
                    <th>Estado pago</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="pago, iStat : ${pagosPagados}"
                    th:attr="data-fecha=${pago.fechaCreacion}">
                    <td th:text="${iStat.index + 1}">1</td>
                    <td>
                        <strong th:text="${pago.mesa != null ? 'Mesa ' + pago.mesa.numero : 'Sin mesa'}">Mesa 1</strong>
                        <br>
                        <small th:text="${pago.fechaCreacion}">2025-11-12 18:30</small>
                    </td>
                    <td>
                        <button type="button" class="btn btn-link p-0 text-start ver-detalle-pago"
                                th:attr="data-origen='historial',
                                         data-pedido-id=${pago.id},
                                         data-mesa=${pago.mesa != null ? pago.mesa.numero : 'Sin mesa'},
                                         data-total=${pago.total},
                                         data-recibido=${pago.montoRecibido},
                                         data-cambio=${pago.cambio},
                                         data-detalle=${pago.orden}">
                            <span class="d-inline-block text-truncate detalle-resumen-text" style="max-width: 360px;">
                                Ver detalle del pedido
                            </span>
                        </button>
                    </td>
                    <td th:text="${#strings.concat('$', #numbers.formatDecimal(pago.total, 0, 'POINT', 0, 'POINT'))}">$0</td>
                    <td>
                        <span class="badge bg-success"
                              th:text="${pago.estado != null ? pago.estado.nombreEstado : 'PAGADO'}">PAGADO</span>
                    </td>
                </tr>

                <tr th:if="${pagosPagados == null or #lists.isEmpty(pagosPagados)}">
                    <td colspan="5" class="text-center py-4">
                        <i class="fas fa-receipt" style="font-size:2rem; color: var(--text-secondary);"></i>
                        <p class="mt-2 mb-0">Aún no hay historial de pagos.</p>
                        <small class="text-muted">Cuando cobres un pedido aparecerá en este listado.</small>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
